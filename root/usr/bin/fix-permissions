#!/bin/sh
# Fix permissions on the given directory to allow group
# read/write of regular files and execute of directories.

export HOME=/opt/xcurrent-server-4.1.1-SNAPSHOT



# Add the grafana user to the $HOME/passwd file with the current
# UID and GID
#echo "xcurrentd:x:${USER_ID}:${GROUP_ID}:xcurrentd user:${HOME}:/sbin/nologin" >> "${HOME}/passwd"

# Point CentOS to this new passwd file instead of the system
# passwd file to make sure the grafana user is correctly assigned
#export LD_PRELOAD=libnss_wrapper.so
#export NSS_WRAPPER_PASSWD=${HOME}/passwd
#export NSS_WRAPPER_GROUP=/etc/group

export USER_ID=$(id -u)
export GROUP_ID=$(id -g)
envsubst < /etc/passwd.template > /tmp/passwd
export LD_PRELOAD=/usr/lib64/libnss_wrapper.so
export NSS_WRAPPER_PASSWD=/tmp/passwd
export NSS_WRAPPER_GROUP=/etc/group

chown -R $USERID $HOME
echo $USERID
chgrp -R 0 $HOME
chmod -R g+rw $HOME
find "$HOME" -type d -exec chmod g+x {} +
